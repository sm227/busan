generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int             @id @default(autoincrement())
  nickname       String          @unique
  password       String
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @default(now()) @updatedAt @map("updated_at")
  bookmarks      Bookmark[]
  commentLikes   CommentLike[]
  comments       Comment[]
  guestbooks     Guestbook[]
  guestbookLikes GuestbookLike[]
  surveyResults  SurveyResult[]
  userBadges     UserBadge[]
  userLikes      UserLike[]
  userProperties UserProperty[]

  @@index([nickname])
  @@map("users")
}

model SurveyResult {
  id           Int      @id @default(autoincrement())
  userId       Int      @map("user_id")
  livingStyle  String   @map("living_style")
  socialStyle  String   @map("social_style")
  workStyle    String   @map("work_style")
  hobbyStyle   String   @map("hobby_style")
  pace         String
  budget       String
  createdAt    DateTime @default(now()) @map("created_at")
  purchaseType String   @map("purchase_type")
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("survey_results")
}

model UserLike {
  id               Int      @id @default(autoincrement())
  userId           Int      @map("user_id")
  propertyId       String   @map("property_id")
  propertyTitle    String   @map("property_title")
  propertyLocation String   @map("property_location")
  propertyPrice    Int?     @map("property_price")
  matchScore       Int?     @map("match_score")
  createdAt        DateTime @default(now()) @map("created_at")
  user             User     @relation(fields: [userId], references: [id])

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
  @@map("user_likes")
}

model Guestbook {
  id             Int             @id @default(autoincrement())
  userId         Int             @map("user_id")
  title          String
  content        String
  location       String?
  rating         Int?
  category       String
  propertyId     String?         @map("property_id")
  tags           String?
  likesCount     Int             @default(0) @map("likes_count")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @default(now()) @updatedAt @map("updated_at")
  bookmarks      Bookmark[]
  comments       Comment[]
  user           User            @relation(fields: [userId], references: [id])
  guestbookLikes GuestbookLike[]

  @@index([userId])
  @@index([category])
  @@index([createdAt])
  @@map("guestbook")
}

model GuestbookLike {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  guestbookId Int       @map("guestbook_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  guestbook   Guestbook @relation(fields: [guestbookId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@unique([userId, guestbookId])
  @@index([userId])
  @@index([guestbookId])
  @@map("guestbook_likes")
}

model Comment {
  id           Int           @id @default(autoincrement())
  guestbookId  Int           @map("guestbook_id")
  userId       Int           @map("user_id")
  content      String
  parentId     Int?          @map("parent_id")
  likesCount   Int           @default(0) @map("likes_count")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @default(now()) @updatedAt @map("updated_at")
  commentLikes CommentLike[]
  guestbook    Guestbook     @relation(fields: [guestbookId], references: [id])
  parent       Comment?      @relation("CommentReplies", fields: [parentId], references: [id])
  replies      Comment[]     @relation("CommentReplies")
  user         User          @relation(fields: [userId], references: [id])

  @@index([guestbookId])
  @@index([userId])
  @@index([parentId])
  @@map("comments")
}

model CommentLike {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  commentId Int      @map("comment_id")
  createdAt DateTime @default(now()) @map("created_at")
  comment   Comment  @relation(fields: [commentId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, commentId])
  @@index([userId])
  @@index([commentId])
  @@map("comment_likes")
}

model Bookmark {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  guestbookId Int       @map("guestbook_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  guestbook   Guestbook @relation(fields: [guestbookId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@unique([userId, guestbookId])
  @@map("bookmarks")
}

model Badge {
  id             String      @id
  name           String
  description    String
  icon           String
  category       String
  conditionType  String      @map("condition_type")
  conditionValue Int         @map("condition_value")
  createdAt      DateTime    @default(now()) @map("created_at")
  userBadges     UserBadge[]

  @@index([category])
  @@index([conditionType])
  @@map("badges")
}

model UserBadge {
  id       Int      @id @default(autoincrement())
  userId   Int      @map("user_id")
  badgeId  String   @map("badge_id")
  earnedAt DateTime @default(now()) @map("earned_at")
  badge    Badge    @relation(fields: [badgeId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
  @@map("user_badges")
}

model PopularPost {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  author    String
  category  String
  location  String?
  imageUrl  String?  @map("image_url")
  views     Int      @default(0)
  likes     Int      @default(0)
  featured  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([category])
  @@index([featured])
  @@index([likes])
  @@index([views])
  @@index([createdAt])
  @@map("popular_posts")
}

model Village {
  id            String   @id
  title         String
  district      String
  city          String
  region        String?
  rent          Int?
  sale          Int?
  deposit       Int?
  rooms         Int
  size          Int
  type          String
  yearBuilt     Int?
  condition     String
  images        Json
  features      Json
  surroundings  Json
  communityInfo Json
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([district])
  @@index([city])
}

model Recommendation {
  id             String   @id @default(cuid())
  userId         Int?
  villageId      String
  title          String
  district       String
  city           String
  region         String?
  rent           Int
  sale           Int?
  deposit        Int?
  rooms          Int
  size           Int
  type           String
  yearBuilt      Int?
  condition      String
  images         Json
  features       Json
  surroundings   Json
  communityInfo  Json
  aiReason       String?
  createdAt      DateTime @default(now())
  contact        String?
  isUserProperty Boolean? @default(false) @map("is_user_property")
  matchScore     Int?     @map("match_score")
  userNickname   String?  @map("user_nickname")

  @@index([userId])
  @@index([villageId])
}

model UserProperty {
  id          String          @id @default(cuid())
  userId      Int             @map("user_id")
  title       String
  description String
  district    String
  city        String
  region      String?
  address     String?
  rent        Int?
  sale        Int?
  deposit     Int?
  rooms       Int
  size        Int
  type        String
  yearBuilt   Int?
  condition   String
  features    Json            @default("[]")
  contact     String
  status      String          @default("active")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @default(now()) @updatedAt @map("updated_at")
  images      PropertyImage[]
  user        User            @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([district])
  @@index([city])
  @@index([createdAt])
  @@map("user_properties")
}

model PropertyImage {
  id         String       @id @default(cuid())
  propertyId String       @map("property_id")
  url        String
  order      Int          @default(0)
  isPrimary  Boolean      @default(false) @map("is_primary")
  createdAt  DateTime     @default(now()) @map("created_at")
  property   UserProperty @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([propertyId, order])
  @@map("property_images")
}
